# logparser

### 개발기간
    2021.03 ~ 2021.05(2개월)   
    
### 개발인원
    1인 개발

### 내용
    LogCollector를 통해 수집된 Access Log 파일 정규표현식 활용 Parsing 후 Pandas Dataframe로 변환 정제 모듈
    
### 개발배경   
    - Access Log Raw 텍스트 데이터를 분석에 이용하기 위한 Structure 변환 및 정제 작업 필요
    - 접근 유저에 대한 행동 분석 및 데이터 집계를 위해 접근 유저별 데이터로 변환 필요
   
### 목적   
    웹 접근 유저의 행동 패턴 분석을 위한 사전 기반 데이터 구성
   
### 개발 중 문제점 및 해결   
    [문제] 로그 파일의 모든 라인이 동일한 인코딩으로 통일되어 있지 않고, window-1256 인코딩이 간헐적으로 존재
    [해결] iconv를 통해 로그 파일을 읽기전 utf-8로 일괄 변환하려 하였으나, file info의 경우 변환이 된것 처럼 보이나 실제 모든 라인이 변환되지 않음.
           해당 에러발생 텍스트 라인을 모두 스킵하기에는 많은 빈도에서 이러한 문제가 있었음
           따라서 로드의 부하는 발생하나 매 라인마다 chardet 라이브러리를 활용하여 encoding 타입을 체크한 후 해당 encoding 타입으로 decoding하는 로직으로 변경
    
    [문제] 접근 유저 구분자 정의
    [해결] 동일한 IP이지만 동일한 유저라고 보장할 수 없음.
           Google Analysis(GA)에서는 쿠키 정보와 IP를 통해 유저를 구분하나
           쿠키 정보를 알 수 없어 HTTP 헤더내 User Agent와 IP가 동일하면, 같은 유저로 보았음
    
    [문제] HTTP 헤더 정보 중 Referer 정보내 큰 따옴표로 인하여 오파싱이 되는 로그 존재
    [해결] 반복적으로 파일 파싱하며, 오류 텍스트 찾아 정규표현식 수정
    
    [문제] 각 유저의 행동이 어떤 의미인지를 부여해야함
    [해결] 웹 서버의 모든 서비스 중인 웹 Java Controller script 파서를 만들어 모든 URL 정보를 긁어온 후 각 파라미터의 의미를 수작업으로 부여하고, 테이블화 하였음
        
### 결과
    실제 고객 DB의 기간별 예약자 수와 파싱한 웹 로그 데이터를 기반으로 만든 접속 유저별 행동 정보 테이블의 예약자 수의 차이가 크게 나지 않음을 확인
    모바일의 경우 IP라도 다른 복수명의 접속자 일 수 있으며, 새로고침/뒤로가기 등의 행동으로 일정 부분 차이가 나는 것으로 추정됨
    
### 활용 라이브러리
    - pandas
    - user_agents
